<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - INDGO AIR Virtual</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <link rel="icon" href="/images/indgo.png" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* Added for the new link button layout */
        .account-link-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: var(--secondary-bg);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .account-link-container span {
            flex-grow: 1;
            color: var(--dashboard-text-muted);
        }
        .account-link-container .cta-button {
            margin: 0; /* Override default button margin */
            padding: 0.5rem 1rem;
            flex-shrink: 0;
        }
        .account-link-container .unlink-btn {
            background-color: var(--error-color);
        }

        /* --- STYLES FOR AIRCRAFT EDIT MODAL & CARDS --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
    background-color: var(--secondary-bg); /* This is the corrected line */
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 700px;
    position: relative;
    transform: scale(0.9);
    transition: transform 0.3s ease;
    border: 1px solid var(--border-color); /* Added a border for better definition */
}
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dashboard-text-muted);
        }
        
        /* New Form Grid Layout */
        .form-grid-two-col {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        .modal-form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: flex-end; /* Align buttons to the right */
        }
        .cta-button.secondary-btn {
            background-color: #555;
            border-color: #555;
        }
        .cta-button.secondary-btn:hover {
             background-color: #666;
        }
        
        /* New Aircraft Card Styles */
        #aircraft-list {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); 
            gap: 1.5rem;
        }
        .aircraft-card {
            display: flex;
            gap: 1rem;
            align-items: center;
            background-color: var(--secondary-bg);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .aircraft-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .aircraft-card-image {
    width: 120px;       /* Increased width for a better, wider aspect ratio */
    height: 80px;       /* Kept height the same, creating a more panoramic box */
    object-fit: contain;  /* This is the key change: fits the whole image without distortion */
    border-radius: 8px;
    flex-shrink: 0;
    background-color: var(--bg-color); /* Corrected CSS variable for a consistent backdrop */
    padding: 5px;       /* Optional: Adds a little breathing room around the image */
}
        .aircraft-card-info {
            flex-grow: 1;
            line-height: 1.5;
        }
        .aircraft-card-info strong {
            font-size: 1.1em;
            color: var(--dashboard-text);
        }
        .aircraft-card-info small {
            color: var(--dashboard-text-muted);
            display: block;
            font-size: 0.85em;
        }
        .aircraft-card-controls {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .aircraft-card-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--dashboard-text-muted);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }
        .aircraft-card-btn.edit-btn {
            border-color: var(--info-color);
            color: var(--info-color);
        }
        .aircraft-card-btn.edit-btn:hover {
            background-color: var(--info-color);
            color: white;
        }
        .aircraft-card-btn.delete-btn {
            border-color: var(--error-color);
            color: var(--error-color);
        }
        .aircraft-card-btn.delete-btn:hover {
            background-color: var(--error-color);
            color: white;
        }
        /* --- END: AIRCRAFT STYLES --- */

        /* --- START: NEW ROUTE MANAGER & PAGINATION STYLES --- */
        .route-manager-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        .pagination-container button {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            color: var(--dashboard-text);
            padding: 0.5rem 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .pagination-container button:hover:not(:disabled) {
            background-color: var(--info-color);
            color: white;
        }
        .pagination-container button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .pagination-container button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* --- START: NEW CODESHARE MODAL REDESIGN --- */
        #codeshare-list-container-modal {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .codeshare-partner-card {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-color);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .codeshare-partner-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .codeshare-partner-card img {
            height: 40px;
            max-width: 90px;
            object-fit: contain;
            margin-bottom: 0.75rem;
        }

        .codeshare-partner-card span {
            font-size: 0.85em;
            font-weight: 500;
            color: var(--dashboard-text-muted);
            line-height: 1.2;
        }

        .delete-codeshare-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--error-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            line-height: 1;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .codeshare-partner-card:hover .delete-codeshare-btn {
            opacity: 1;
            transform: scale(1);
        }
        /* --- END: NEW CODESHARE MODAL REDESIGN --- */
        /* --- END: NEW ROUTE MANAGER STYLES --- */
    </style>
</head>
<body>
    <div id="mobile-scroll-logo">
        <img src="Images/icon.png" alt="INDGO AIR Virtual Banner">
    </div>

    <div class="dashboard-container">
        <button id="sidebar-toggle" class="sidebar-toggle-btn" title="Toggle Sidebar">
            <i class="fas fa-bars"></i> </button>
        <a href="crew-center.html" id="mobile-crew-center-btn" class="mobile-fab" title="Go to Crew Center">
            <i class="fas fa-plane"></i>
        </a>

        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <img src="/images/indgo.png" alt="Logo" class="logo-image">
                    <span class="logo-text">Dashboard</span>
                </div>
                <button id="desktop-sidebar-toggle" class="desktop-toggle-btn" title="Toggle Sidebar">
                    <i class="fas fa-angle-double-left"></i>
                </button>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-category category-open"> <a href="#" class="nav-category-header">
                            <i class="fas fa-user-cog"></i>
                            <span class="nav-text">Account Settings</span>
                            <i class="fas fa-chevron-down category-arrow"></i>
                        </a>
                        <ul class="nav-submenu">
                            <li><a href="#" class="nav-link active" data-view="tab-profile"><i class="fas fa-user-edit"></i><span class="nav-text">My Profile</span></a></li>
                            <li><a href="#" class="nav-link" data-view="tab-password"><i class="fas fa-key"></i><span class="nav-text">Security</span></a></li>
                        </ul>
                    </li>

                    <li class="nav-category">
                        <a href="#" class="nav-category-header">
                            <i class="fas fa-tasks"></i>
                            <span class="nav-text">Management</span>
                             <i class="fas fa-chevron-down category-arrow"></i>
                        </a>
                        <ul class="nav-submenu">
                            <li id="pirep-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-pirep-management"><i class="fas fa-check-square"></i><span class="nav-text">PIREP Management</span></a></li>
                            <li id="roster-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-roster-management"><i class="fas fa-clipboard-list"></i><span class="nav-text">Roster Management</span></a></li>
                            <li id="route-manager-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-route-manager"><i class="fas fa-route"></i><span class="nav-text">Route Manager</span></a></li>
                            <li id="aircraft-manager-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-aircraft-manager"><i class="fas fa-plane"></i><span class="nav-text">Aircraft Manager</span></a></li>
                            <li id="pilot-management-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-pilot-management"><i class="fas fa-user-cog"></i><span class="nav-text">Manage Pilots</span></a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-category">
                        <a href="#" class="nav-category-header">
                           <i class="fas fa-bullhorn"></i>
                           <span class="nav-text">Content</span>
                            <i class="fas fa-chevron-down category-arrow"></i>
                        </a>
                        <ul class="nav-submenu">
                             <li id="community-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-community"><i class="fas fa-users"></i><span class="nav-text">Community</span></a></li>
                        </ul>
                    </li>

                    <li class="nav-category">
                        <a href="#" class="nav-category-header">
                            <i class="fas fa-shield-alt"></i>
                            <span class="nav-text">Administration</span>
                            <i class="fas fa-chevron-down category-arrow"></i>
                        </a>
                        <ul class="nav-submenu">
                             <li id="admin-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-admin"><i class="fas fa-user-shield"></i><span class="nav-text">Admin Tools</span></a></li>
                             <li id="pilot-tab-link" style="display: none;"><a href="#" class="nav-link" data-view="tab-pilots"><i class="fas fa-database"></i><span class="nav-text">Pilot Database</span></a></li>
                        </ul>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="sidebar-profile">
                    <img id="profile-picture" src="images/default-avatar.png" alt="Profile Picture" class="profile-img">
                    <div class="profile-details">
                        <h3 id="pilot-name">Loading...</h3>
                        <p id="pilot-callsign" class="user-role">Loading...</p>
                    </div>
                    <a href="#" id="sidebar-logout-btn" class="logout-button" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="nav-text">Logout</span>
                    </a>
                </div>
                <div class="sidebar-actions">
                    <a href="crew-center.html" class="dashboard-link"><i class="fas fa-plane"></i><span class="nav-text">Crew Center</span></a>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div id="loading-overlay">
                <div class="spinner"></div>
            </div>
            <h1 id="welcome-message">Welcome, [Staff Name]!</h1>
            <p style="color: var(--dashboard-text-muted); margin-bottom: 2rem;">Open the menu from the sidebar for more options.</p>
            
            <div id="tab-profile" class="content-card active">
                <h2><i class="fas fa-user-edit"></i> Update Profile Information</h2>
                <p>Do not post sensitive information in your bio.</p>
                <form id="profile-form" class="dashboard-form">
                    <div class="form-group">
                        <label for="profile-name">Full Name</label>
                        <input type="text" id="profile-name" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-bio">About Me (Bio)</label>
                        <textarea id="profile-bio" rows="4"></textarea>
                    </div>
                    <hr style="margin: 2rem 0;">
                    <div class="form-group">
                        <label for="profile-infinite-flight-username">Infinite Flight Username</label>
                        <input type="text" id="profile-infinite-flight-username" name="infiniteFlightUsername">
                    </div>
                    <div class="form-group">
                        <label>Discord Account</label>
                        <div class="account-link-container">
                            <span id="discord-status">Checking status...</span>
                            <button type="button" id="link-discord-btn" class="cta-button">Link Discord</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="profile-ifc">Infinite Flight Community Profile URL</label>
                        <input type="url" id="profile-ifc" placeholder="e.g., https://community.infiniteflight.com/u/username">
                    </div>
                    <div class="form-group">
                        <label for="profile-youtube">YouTube Channel URL</label>
                        <input type="url" id="profile-youtube" placeholder="e.g., https://www.youtube.com/channel/yourchannel">
                    </div>
                    <div class="form-group">
                        <label for="profile-preferred">Preferred Contact Method</label>
                        <select id="profile-preferred">
                            <option value="none">None</option>
                            <option value="ifc">IFC</option>
                            <option value="youtube">YouTube</option>
                        </select>
                    </div>
                    <hr style="margin: 2rem 0;">
                    <div class="form-group">
                        <label for="profile-picture-input">Update Profile Picture</label>
                        <input type="file" id="profile-picture-input" accept="image/*">
                    </div>
                    <button type="submit" class="cta-button">Save Changes</button>
                </form>
            </div>

            <div id="tab-password" class="content-card">
                <h2><i class="fas fa-key"></i> Change Password</h2>
                <p>For your security, choose a strong, unique password.</p>
                <form id="password-form" class="dashboard-form">
                    <div class="form-group">
                        <label for="current-password">Current Password</label>
                        <input type="password" id="current-password" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">New Password</label>
                        <input type="password" id="new-password" required>
                    </div>
                     <div class="form-group">
                        <label for="confirm-password">Confirm New Password</label>
                        <input type="password" id="confirm-password" required>
                    </div>
                    <button type="submit" class="cta-button">Update Password</button>
                </form>
            </div>

            <div id="tab-pirep-management" class="content-card">
                <h2><i class="fas fa-check-square"></i> Pending Flight Reports</h2>
                <p>Review the following reports. Approving a PIREP will automatically update the pilot's flight hours and check for rank promotions.</p>
                <div id="pending-pireps-container">
                    <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div>
                    <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div>
                </div>
            </div>

            <div id="tab-roster-management" class="content-card">
                 </div>

            <div id="tab-route-manager" class="content-card">
                 </div>

            <div id="tab-aircraft-manager" class="content-card">
                </div>

            <div id="tab-pilot-management" class="content-card">
                <h2><i class="fas fa-user-cog"></i> Pilot Roster Management</h2>
                <p>Promote, demote, or change the rank of pilots in the virtual airline. Pilots awaiting promotion tests are highlighted.</p>
                
                <div id="pilot-management-container" class="user-list-container-style">
                    <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    <div class="skeleton-card"><div class="skeleton-line"></div></div>
                </div>
            </div>

            <div id="tab-admin" class="content-card">
                <h2><i class="fas fa-user-shield"></i> Administrator Tools</h2>
                <p>Manage team members and site settings.</p>

                <div id="live-ops-panel" class="content-card">
                    <h3>Live Operations</h3>
                    <div id="live-ops-container" class="user-list-container-style">
                        <div class="skeleton-card"><div class="skeleton-line short"></div></div>
                    </div>
                </div>
                
                <div id="manage-users-panel" class="content-card">
                    <h3>Manage Team Members</h3>
                    <div id="user-list-container">
                        <div class="skeleton-card"><div class="skeleton-line"></div></div>
                        <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    </div>
                </div>

                <div id="manage-invites-panel" class="content-card">
                    <h3>Manage Pilot Invitations</h3>
                    <p>Create or delete invite codes for new pilots to register.</p>
                    <button id="create-invite-btn" class="cta-button" style="margin-bottom: 1.5rem;">Create New Invite Code</button>
                    <div id="invite-list-container">
                        <div class="skeleton-card"><div class="skeleton-line"></div></div>
                        <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    </div>
                </div>

                <div id="admin-panel" class="content-card">
                    <h3>Add New Team Member</h3>
                    <form id="add-member-form" class="dashboard-form">
                         <div class="form-group">
                            <label for="new-member-name">Full Name</label>
                            <input type="text" id="new-member-name" required>
                        </div>
                         <div class="form-group">
                            <label for="new-member-email">Email Address</label>
                            <input type="email" id="new-member-email" required>
                        </div>
                        <div class="form-group">
                            <label for="new-member-password">Initial Password</label>
                            <input type="password" id="new-member-password" required>
                        </div>
                        <div class="form-group">
                            <label for="new-member-role">Assign Role</label>
                            <select id="new-member-role" required>
                                <optgroup label="General Roles">
                                    <option value="staff">Staff</option>
                                    <option value="pilot">Pilot</option>
                                    <option value="admin">Admin (Site Control)</option>
                                </optgroup>
                                <optgroup label="Leadership & Management">
                                    <option value="Chief Executive Officer (CEO)">Chief Executive Officer (CEO)</option>
                                    <option value="Chief Operating Officer (COO)">Chief Operating Officer (COO)</option>
                                    <option value="PIREP Manager (PM)">PIREP Manager (PM)</option>
                                    <option value="Pilot Relations & Recruitment Manager (PR)">Pilot Relations & Recruitment Manager (PR)</option>
                                    <option value="Technology & Design Manager (TDM)">Technology & Design Manager (TDM)</option>
                                    <option value="Head of Training (COT)">Head of Training (COT)</option>
                                    <option value="Chief Marketing Officer (CMO)">Chief Marketing Officer (CMO)</option>
                                    <option value="Route Manager (RM)">Route Manager (RM)</option>
                                    <option value="Events Manager (EM)">Events Manager (EM)</option>
                                </optgroup>
                                <optgroup label="Flight Operations">
                                    <option value="Flight Instructor (FI)">Flight Instructor (FI)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-member-callsign">Callsign (optional)</label>
                            <input type="text" id="new-member-callsign" name="callsign" placeholder="e.g. INDGO-01">
                        </div>
                        <button type="submit" class="cta-button">Create Member</button>
                    </form>
                </div>

                <div id="view-logs-panel" class="content-card">
                    <h3>Admin Activity Log</h3>
                    <div id="log-container">
                        <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div>
                        <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div>
                    </div>
                </div>
            </div>

            <div id="tab-community" class="content-card">
                <h2><i class="fas fa-users"></i> Community Content Management</h2>
                <p>Create and manage events and weekly highlights for the community page.</p>

                <div id="create-event-panel" class="content-card">
                    <h3>Post a New Event</h3>
                    <form id="create-event-form" class="dashboard-form">
                        <div class="form-group">
                            <label for="event-title">Event Title</label>
                            <input type="text" id="event-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="event-date">Event Date & Time</label>
                            <input type="datetime-local" id="event-date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="event-description">Description</label>
                            <textarea id="event-description" name="description" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="event-image">Event Image</label>
                            <input type="file" id="event-image" name="eventImage" accept="image/*">
                        </div>
                        <button type="submit" class="cta-button">Post Event</button>
                    </form>
                </div>

                <div id="create-highlight-panel" class="content-card">
                    <h3>Post a Weekly Highlight</h3>
                    <form id="create-highlight-form" class="dashboard-form">
                        <div class="form-group">
                            <label for="highlight-title">Highlight Title (e.g., Best Picture of the Week)</label>
                            <input type="text" id="highlight-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="highlight-winner">Winner / Pilot Name</label>
                            <input type="text" id="highlight-winner" name="winnerName" required>
                        </div>
                        <div class="form-group">
                            <label for="highlight-description">Brief Description</label>
                            <textarea id="highlight-description" name="description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="highlight-image">Winning Picture/Screenshot</label>
                            <input type="file" id="highlight-image" name="highlightImage" accept="image/*" required>
                        </div>
                        <button type="submit" class="cta-button">Post Highlight</button>
                    </form>
                </div>

                <div id="manage-events-panel" class="content-card">
                    <h3>Manage Existing Events</h3>
                    <div id="manage-events-container">
                        <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    </div>
                </div>

                <div id="manage-highlights-panel" class="content-card">
                    <h3>Manage Existing Highlights</h3>
                    <div id="manage-highlights-container">
                        <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    </div>
                </div>
            </div>

            <div id="tab-pilots" class="content-card">
                <h2><i class="fas fa-database"></i> Pilot Database</h2>
                <p>View pilots, ranks, flight hours and manage callsigns.</p>
                <div id="pilot-db-container">
                    <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    <div class="skeleton-card"><div class="skeleton-line"></div></div>
                    <div class="skeleton-card"><div class="skeleton-line"></div></div>
                </div>
            </div>

        </main>
    </div>
    
    <div id="cropper-modal" style="display: none;">
        <div class="cropper-modal-overlay"></div>
        <div class="cropper-modal-content">
            <h2>Adjust Your Profile Picture</h2>
            <div class="cropper-container">
                <img id="image-to-crop" src="">
            </div>
            <div class="cropper-modal-actions">
                <button id="cancel-crop-btn" class="cta-button" style="background-color: #555;">Cancel</button>
                <button id="crop-and-save-btn" class="cta-button">Crop & Save</button>
            </div>
        </div>
    </div>

    <div id="aircraft-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="aircraft-modal-title">Manage Aircraft</h2>
            <button id="aircraft-modal-close-btn" class="modal-close-btn" title="Close">&times;</button>
            <form id="aircraft-modal-form" class="dashboard-form">
                <input type="hidden" id="modal-ac-edit-id">
                <div class="form-grid-two-col">
                     <div class="form-group"><label for="modal-ac-name">Name</label><input id="modal-ac-name" required placeholder="Airbus A320-200"></div>
                     <div class="form-group"><label for="modal-ac-icao">ICAO Code</label><input id="modal-ac-icao" required maxlength="4" placeholder="A320"></div>
                     <div class="form-group"><label for="modal-ac-type">Type</label>
                        <select id="modal-ac-type" class="form-control">
                            <option value="narrowbody">Narrowbody</option>
                            <option value="widebody">Widebody</option>
                            <option value="turboprop">Turboprop</option>
                            <option value="regional jet">Regional Jet</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                     <div class="form-group"><label for="modal-ac-rank">Rank Unlock</label>
                        <select id="modal-ac-rank" class="form-control"></select>
                    </div>
                     <div class="form-group full-width"><label for="modal-ac-codeshare">Operator / Codeshare</label>
                        <select id="modal-ac-codeshare" class="form-control"></select>
                    </div>
                </div>
                <hr style="margin: 1.5rem 0; border-color: var(--border-color);">
                <p style="font-size: 0.9em; color: var(--dashboard-text-muted);">Use a link or upload a file for the aircraft image. Uploading a file will override any URL provided.</p>
                 <div class="form-grid-two-col">
                    <div class="form-group"><label for="modal-ac-image-url">Picture URL (Optional)</label><input id="modal-ac-image-url" type="url" placeholder="https://example.com/image.png"></div>
                    <div class="form-group"><label for="modal-ac-image-file">Or Upload Picture (Optional)</label><input id="modal-ac-image-file" type="file" accept="image/*" class="form-control"></div>
                </div>
                <div class="modal-form-actions">
                    <button id="modal-ac-cancel-btn" type="button" class="cta-button secondary-btn">Cancel</button>
                    <button id="modal-ac-save-btn" type="submit" class="cta-button">Save Aircraft</button>
                </div>
            </form>
        </div>
    </div>

    <div id="route-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="route-modal-title">Add New Route</h2>
            <button class="modal-close-btn" data-modal-id="route-modal" title="Close">&times;</button>
            <form id="add-route-form" class="dashboard-form">
                <div class="form-grid-two-col">
                    <div class="form-group"><label for="route-flightnumber">Flight Number</label><input type="text" id="route-flightnumber" required></div>
                    <div class="form-group"><label for="route-aircraft">Aircraft</label><input type="text" id="route-aircraft" required></div>
                    <div class="form-group"><label for="route-departure">Departure ICAO</label><input type="text" id="route-departure" maxlength="4" required></div>
                    <div class="form-group"><label for="route-arrival">Arrival ICAO</label><input type="text" id="route-arrival" maxlength="4" required></div>
                    <div class="form-group"><label for="route-flighttime">Flight Time (Hours)</label><input type="number" id="route-flighttime" step="0.1" min="0.1" required></div>
                    <div class="form-group"><label for="route-livery">Livery</label><input type="text" id="route-livery" placeholder="e.g., Oneworld" required></div>
                    <div class="form-group full-width"><label for="route-operator">Operator</label><select id="route-operator" required></select></div>
                </div>
                <div class="modal-form-actions">
                    <button type="button" class="cta-button secondary-btn" data-modal-id="route-modal">Cancel</button>
                    <button type="submit" class="cta-button">Add Route</button>
                </div>
            </form>
        </div>
    </div>

    <div id="codeshare-modal" class="modal-overlay">
    <div class="modal-content">
        <h2>Manage Codeshare Partners</h2>
        <button class="modal-close-btn" data-modal-id="codeshare-modal" title="Close">&times;</button>
        <p style="color: var(--dashboard-text-muted); font-size: 0.9em; margin-bottom: 1.5rem;">Partners added here will be available globally for routes and aircraft.</p>
        
        <form id="add-codeshare-form" class="dashboard-form">
            <div class="form-grid-two-col">
                <div class="form-group"><label for="codeshare-name">Airline Name</label><input type="text" id="codeshare-name" placeholder="e.g., Qatar Airways" required></div>
                <div class="form-group"><label for="codeshare-logo">Logo URL</label><input type="url" id="codeshare-logo" placeholder="https://example.com/logo.png" required></div>
            </div>
            <button type="submit" class="cta-button" style="margin-top: 1rem;">Add New Partner</button>
        </form>

        <div class="modal-body">
            <hr style="margin: 0 0 1.5rem 0;"> <h3>Existing Partners</h3>
            <div id="codeshare-list-container-modal"><p>Loading partners...</p></div>
            <div id="codeshare-pagination-controls-modal" class="pagination-container"></div>
        </div>
        </div>
</div>

    <div id="import-sheet-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Import Routes from Google Sheet</h2>
            <button class="modal-close-btn" data-modal-id="import-sheet-modal" title="Close">&times;</button>
            <p style="color: var(--dashboard-text-muted); font-size: 0.9em; margin-bottom: 1.5rem;">Paste a published Google Sheet CSV link to bulk-add routes for an operator.</p>
            <form id="import-sheet-form" class="dashboard-form">
                <div class="form-group">
                    <label for="import-sheet-url">Google Sheet CSV URL</label>
                    <input type="url" id="import-sheet-url" required placeholder="https://docs.google.com/spreadsheets/d/e/.../pub?output=csv">
                </div>
                <div class="form-group">
                    <label for="import-sheet-operator-select">Operator for these Routes</label>
                    <select id="import-sheet-operator-select" required class="form-control"></select>
                </div>
                <div class="modal-form-actions">
                    <button type="button" class="cta-button secondary-btn" data-modal-id="import-sheet-modal">Cancel</button>
                    <button type="submit" id="import-sheet-btn" class="cta-button">Import Routes</button>
                </div>
            </form>
        </div>
    </div>
    <div id="notification-bell-container" class="notification-container">
        <a href="#" id="notification-bell" class="notification-button">
            <i class="fas fa-bell"></i>
            <span id="notification-badge" class="badge" style="display: none;"></span>
        </a>
        <div id="notification-panel" class="notification-dropdown">
            <div class="notification-header">Your Notifications</div>
            <div id="notification-list">
                </div>
        </div>
    </div>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="dashboard.js" defer></script>
</body>
</html>